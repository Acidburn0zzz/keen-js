"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,s,a=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?l+"":"null";case"boolean":case"null":return l+"";case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)s[n]=str(n,l)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,l),r&&s.push(quote(i)+(gap?": ":":")+r));else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(r=str(i,l),r&&s.push(quote(i)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var Keen=Keen||{};(function(){function e(){return"withCredentials"in new XMLHttpRequest}function t(e,t,n,i,r,o,s){var a=new XMLHttpRequest;if(a.onreadystatechange=function(){if(4==a.readyState)if(a.status>=200&&300>a.status){var e;try{e=JSON.parse(a.responseText)}catch(t){console.log("Could not JSON parse HTTP response: "+a.responseText),s&&s(a,t)}e&&o&&o(e)}else console.log("HTTP request failed."),s&&s(a,null)},a.open(e,t,!0),r&&a.setRequestHeader("Authorization",r),i&&a.setRequestHeader("Content-Type","application/json"),n)for(var l in n)n.hasOwnProperty(l)&&a.setRequestHeader(l,n[l]);var h=i?JSON.stringify(i):null;a.send(h)}function n(e,t,n,i){if(t&&0>e.indexOf("api_key")){var r=e.indexOf("?")>0?"&":"?";e=e+r+"api_key="+t}for(var o="keenJSONPCallback"+(new Date).getTime();o in window;)o+="a";var s=!1;window[o]=function(e){s=!0,n&&e&&n(e),window[o]=void 0},e=e+"&jsonp="+o;var a=document.createElement("script");a.id="keen-jsonp",a.src=e,document.getElementsByTagName("head")[0].appendChild(a),a.onreadystatechange=function(){s===!1&&"loaded"===this.readyState&&(s=!0,i&&i())},a.onerror=function(){s===!1&&(s=!0,i&&i())}}function i(e,t){var n="";return"daily"==t||"weekly"==t?(n+=1+e.getMonth(),n+="/",n+=e.getDate()):"hourly"==t?(n+=e.getHours(),n+=":",n+="00"):"monthly"==t?(n+=1+e.getMonth(),n+="/",n+=(e.getFullYear()+"").slice(-2)):"minutely"==t?(n+=e.getHours(),n+=":",n+=("0"+e.getMinutes()).slice(-2)):console.log("Invalid interval: "+t),n}function r(e){var t,n,i=[1,4,5,6,7,10,11],r=0;if(n=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(e)){for(var o,s=0;o=i[s];++s)n[o]=+n[o]||0;n[2]=(+n[2]||1)-1,n[3]=+n[3]||1,"Z"!==n[8]&&void 0!==n[9]&&(r=60*n[10]+n[11],"+"===n[9]&&(r=0-r)),t=Date.UTC(n[1],n[2],n[3],n[4],n[5]+r,n[6],n[7])}else t=Date.parse?Date.parse(e):0/0;return new Date(t)}function o(){return-60*(new Date).getTimezoneOffset()}function s(e){return _.each(e,function(t,n){_.isUndefined(t)&&delete e[n]}),_.map(e,function(e,t){return _.isString(e)||(e=JSON.stringify(e)),e=encodeURIComponent(e),t+"="+e}).join("&")}var a=!1;("undefined"==typeof console||console.log===void 0)&&(console={},console.log=a?function(e){alert(e)}:function(){});var l=function(){};if(l.extend=function(e,t){var n=l.prototype.extend;l._prototyping=!0;var i=new this;n.call(i,e),i.base=function(){},delete l._prototyping;var r=i.constructor,o=i.constructor=function(){if(!l._prototyping)if(this._constructing||this.constructor==o)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],i)};return o.ancestor=this,o.extend=this.extend,o.forEach=this.forEach,o.implement=this.implement,o.prototype=i,o.toString=this.toString,o.valueOf=function(e){return"object"==e?o:r.valueOf()},n.call(o,t),"function"==typeof o.init&&o.init(),o},l.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var i=t.valueOf();t=function(){var e=this.base||l.prototype.base;this.base=n;var t=i.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:i},t.toString=l.toString}this[e]=t}else if(e){var r=l.prototype.extend;l._prototyping||"function"==typeof this||(r=this.extend||r);for(var o={toSource:null},s=["constructor","toString","valueOf"],a=l._prototyping?0:1;h=s[a++];)e[h]!=o[h]&&r.call(this,h,e[h]);for(var h in e)o[h]||r.call(this,h,e[h])}return this}},l=l.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var i in e)void 0===this.prototype[i]&&t.call(n,e[i],i,e)},implement:function(){for(var e=0;arguments.length>e;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return this.valueOf()+""}}),Keen.configure=function(e,t,n){return this.client=new Keen.Client(e,t,n),this.client},Keen.addEvent=function(e,t,n,i){this.client&&this.client.uploadEvent(e,t,n,i)},Keen.getEventCollections=function(e,t){var n=this.client.getKeenUrl("/events");this.client.getJSON(n,e,t)},Keen.getEventCollectionProperties=function(e,t,n){var i=this.client.getKeenUrl("/events/"+e);this.client.getJSON(i,t,n)},Keen.setGlobalProperties=function(e){if(this.client){if(!e||"function"!=typeof e)throw Error("Invalid value for global properties: "+e);this.client.globalProperties=e}},Keen.addChartsReadyHandler=function(e){this.chartsReadyHandlers===void 0&&(this.chartsReadyHandlers=[]),this.chartsReadyHandlers.push(e),this.chartsReady&&this.runChartsReadyHandlers()},Keen.onChartsReady=function(e){this.chartsReady?e():(this.addChartsReadyHandler(e),this.loadChartsDependencies())},Keen.runChartsReadyHandlers=function(){_.each(this.chartsReadyHandlers,function(e){e()},this)},Keen.loadChartsDependencies=function(){if(!this.startedLoadingChartsDependencies){this.startedLoadingChartsDependencies=!0;var e=function(e,t){var n,i=document,r=i.head||i.getElementsByTagName("head");setTimeout(function(){if("item"in r){if(!r[0])return setTimeout(arguments.callee,25),void 0;r=r[0]}var n=i.createElement("script"),o=!1;n.onload=n.onreadystatechange=function(){return n.readyState&&"complete"!==n.readyState&&"loaded"!==n.readyState||o?!1:(n.onload=n.onreadystatechange=null,o=!0,t(),void 0)},n.src=e,r.insertBefore(n,r.firstChild)},0),null==i.readyState&&i.addEventListener&&(i.readyState="loading",i.addEventListener("DOMContentLoaded",n=function(){i.removeEventListener("DOMContentLoaded",n,!1),i.readyState="complete"},!1))},t=this,n=function(){t.chartsReady=!0,t.runChartsReadyHandlers()},i=function(){"undefined"==typeof google?console.log("Problem loading visualizations.  Please contact us!"):google.load("visualization","1.0",{packages:["corechart"],callback:n})};e("https://www.google.com/jsapi",function(){"undefined"==typeof _?e("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js",i):i()})}},Keen.Client=function(e,t,n){this.projectToken=e,this.apiKey=t,this.globalProperties=null,this.keenUrl="https://api.keen.io",void 0!==n&&void 0!==n.keenUrl&&(this.keenUrl=n.keenUrl)},Keen.Client.prototype.uploadEvent=function(i,r,o,s){var a=this.getKeenUrl("/events/"+i),l={};this.globalProperties&&(l=this.globalProperties(i));for(var h in r)r.hasOwnProperty(h)&&(l[h]=r[h]);if(e())t("POST",a,null,l,null,o,s);else{var u=JSON.stringify(l),c=Keen.Base64.encode(u);a=a+"?data="+c,a=a+"&modified="+(new Date).getTime(),n(a,null,o,s)}},Keen.Client.prototype.getKeenUrl=function(e){return this.keenUrl+"/3.0/projects/"+this.projectToken+e},Keen.Client.prototype.getJSON=function(i,r,o){e()?t("GET",i,null,null,this.apiKey,r,o):n(i,this.apiKey,r,o)},Keen.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,i,r,o,s,a,l="",h=0;for(e=Keen.Base64._utf8_encode(e);e.length>h;)t=e.charCodeAt(h++),n=e.charCodeAt(h++),i=e.charCodeAt(h++),r=t>>2,o=(3&t)<<4|n>>4,s=(15&n)<<2|i>>6,a=63&i,isNaN(n)?s=a=64:isNaN(i)&&(a=64),l=l+Keen.Base64._keyStr.charAt(r)+Keen.Base64._keyStr.charAt(o)+Keen.Base64._keyStr.charAt(s)+Keen.Base64._keyStr.charAt(a);return l},decode:function(e){var t,n,i,r,o,s,a,l="",h=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");e.length>h;)r=Keen.Base64._keyStr.indexOf(e.charAt(h++)),o=Keen.Base64._keyStr.indexOf(e.charAt(h++)),s=Keen.Base64._keyStr.indexOf(e.charAt(h++)),a=Keen.Base64._keyStr.indexOf(e.charAt(h++)),t=r<<2|o>>4,n=(15&o)<<4|s>>2,i=(3&s)<<6|a,l+=String.fromCharCode(t),64!=s&&(l+=String.fromCharCode(n)),64!=a&&(l+=String.fromCharCode(i));return l=Keen.Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(192|i>>6),t+=String.fromCharCode(128|63&i)):(t+=String.fromCharCode(224|i>>12),t+=String.fromCharCode(128|63&i>>6),t+=String.fromCharCode(128|63&i))}return t},_utf8_decode:function(e){for(var t="",n=0,i=c1=c2=0;e.length>n;)i=e.charCodeAt(n),128>i?(t+=String.fromCharCode(i),n++):i>191&&224>i?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),n+=3);return t}},Keen._pId&&(Keen.configure(Keen._pId,Keen._ak,Keen._op),Keen._pId=null,Keen._ak=null,Keen._op=null),Keen._gp&&(Keen.setGlobalProperties(Keen._gp),Keen._gp=null),Keen._eq&&Keen._eq.length>0){for(var h=0;Keen._eq.length>h;h++){var u=Keen._eq[h].shift(),c=Keen._eq[h].shift(),d=Keen._eq[h].shift(),p=Keen._eq[h].shift();Keen.addEvent(u,c,d,p)}Keen._eq=null}if(Keen._ocrq&&Keen._ocrq.length>0){for(var h=0;Keen._ocrq.length>h;h++){var f=Keen._ocrq[h];Keen.onChartsReady(f)}Keen._ocrq=null}Keen.BaseVisualization=l.extend({}),Keen.BaseVisualization.prototype.getLabel=function(){if(_.isUndefined(this.options.label)||null==this.options.label){if(_.isUndefined(this.query.queryName)){var e="";return e+=this.query.attributes.analysisType,e+=" - ",e+=this.query.attributes.eventCollection}return this.query.queryName}return this.options.label},Keen.Number=Keen.BaseVisualization.extend({constructor:function(e,t){this.query=e,this.options={height:"150px",width:"300px","font-family":"'Helvetica Neue', Helvetica, Arial, sans-serif",color:"white","border-radius":"0px","number-background-color":"#7dcc77","label-background-color":"#9CD898",prefix:"",suffix:""},this.options=_.extend(this.options,t)}}),Keen.Number.prototype.draw=function(e,t){var n=function(e){return+e.replace(/[^\d.-]+/gi,"")},i=function(e){return e.replace(/[^A-Za-z%]+/gi,"")};e.innerHTML="";var r=document.createElement("div");e.appendChild(r),r.style.width=this.options.width,r.style.height=this.options.height,r.style.display="block",r.style.textAlign="center",r.style.backgroundColor=this.options["number-background-color"],r.style.borderRadius=this.options["border-radius"];var o=document.createElement("h1");r.appendChild(o);var s=document.createTextNode("Loading...");o.style.fontSize=.5*(8*n(this.options.height)/15)+i(this.options.height),o.appendChild(s),o.style.height=2*n(this.options.height)/3+i(this.options.height),o.style.lineHeight=o.style.height,o.style.color=this.options.color,o.style.fontWeight="bold",o.style.fontFamily=this.options["font-family"],o.style.margin=0,o.style.padding=0,o.style.textShadow="none";var a=document.createElement("h2");a.appendChild(document.createTextNode(this.getLabel())),r.appendChild(a),a.style.height=n(this.options.height)/3+i(this.options.height),a.style.lineHeight=a.style.height,a.style.fontSize=.32*(n(this.options.height)/3)+i(this.options.height),a.style.color=o.style.color,a.style.textTransform="uppercase",a.style.fontWeight="normal",a.style.fontFamily=o.style.fontFamily,a.style.margin=0,a.style.padding=0,a.style.borderTop="1px solid",a.style.borderTopColor=this.options.color,a.style.backgroundColor=this.options["label-background-color"],a.style.textShadow="none";var l=_.bind(function(e){this.data=e.result,null==this.data&&(this.data=0),o.replaceChild(document.createTextNode(this.options.prefix+Keen.prettyNumber(this.data)+this.options.suffix),s),o.style.fontSize=8*n(this.options.height)/15+i(this.options.height),null==this.data&&(this.data=0)},this);_.isUndefined(t)?this.query.getResponse(l):l(t)},Keen.LineChart=Keen.BaseVisualization.extend({constructor:function(e,t){this.query=e,this.options={chartAreaHeight:null,chartAreaWidth:null,chartAreaLeft:null,chartAreaTop:null,height:300,width:600,lineWidth:5,color:"#00afd7",backgroundColor:"white",title:null,label:null,xAxisLabel:null,yAxisLabel:null,showLegend:!0,xAxisLabelAngle:null},this.options=_.extend(this.options,t),this.client=_.isUndefined(this.options.client)?Keen.client:this.options.client}}),Keen.LineChart.prototype.draw=function(e,t){e.innerHTML="",e.style.width=this.options.width+"px",e.style.height=this.options.height+"px",e.style.display="block";var n=Keen.showLoading(e),o=function(e){var t={};return t.height=e.height,t.width=e.width,t.lineWidth=e.lineWidth,t.colors=[e.color],t.backgroundColor=e.backgroundColor,t.title=e.title,t.hAxis={title:e.xAxisLabel},t.vAxis={title:e.yAxisLabel,viewWindow:{min:0}},e.showLegend||(t.legend={position:"none"}),null!=e.xAxisLabelAngle&&(t.hAxis.slantedText=!0,t.hAxis.slantedTextAngle=e.xAxisLabelAngle),t.chartArea={left:e.chartAreaLeft,top:e.chartAreaTop,height:e.chartAreaHeight,width:e.chartAreaWidth},t},s=_.bind(function(t){this.data=t.result;var s=new google.visualization.DataTable;if(s.addColumn("string","Date"),s.addColumn("number",this.getLabel()),s.addRows(_.map(this.data,function(e){var t=r(e.timeframe.start),n=i(t,this.query.attributes.interval);return[n,e.value]},this)),google){var a=new google.visualization.AreaChart(e),l=o(this.options);clearInterval(n),a.draw(s,l)}else console.log("Charting is not yet ready.  Are you waiting for onChartsReady?")},this);_.isUndefined(t)?this.query.getResponse(s):s(t)},Keen.MultiLineChart=Keen.BaseVisualization.extend({constructor:function(e,t){this.query=e,this.options={height:300,width:600,chartAreaHeight:null,chartAreaWidth:null,chartAreaLeft:null,chartAreaTop:null,title:null,showLegend:!0,colors:null,lineWidth:5,backgroundColor:"white",fontColor:"black",xAxisLabel:null,yAxisLabel:null,xAxisLabelAngle:null},this.options=_.extend(this.options,t),this.client=_.isUndefined(this.options.client)?Keen.client:this.options.client}}),Keen.MultiLineChart.prototype.draw=function(e,t){e.innerHTML="",e.style.width=this.options.width+"px",e.style.height=this.options.height+"px",e.style.display="block";var n=Keen.showLoading(e),o=function(e){var t={};return t.height=e.height,t.width=e.width,t.lineWidth=e.lineWidth,t.colors=e.colors,t.backgroundColor=e.backgroundColor,t.title=e.title,t.label=e.label,t.hAxis={title:e.xAxisLabel},t.vAxis={title:e.yAxisLabel,viewWindow:{min:0}},e.showLegend||(t.legend={position:"none"}),null!=e.xAxisLabelAngle&&(t.hAxis.slantedText=!0,t.hAxis.slantedTextAngle=e.xAxisLabelAngle),t.chartArea={left:e.chartAreaLeft,top:e.chartAreaTop,height:e.chartAreaHeight,width:e.chartAreaWidth},t},s=_.bind(function(t){this.data=t.result;var s=[];_.each(this.data[0].value,function(e){s.push(e[this.query.attributes.groupBy])},this),0==s.length&&(s.push(null),this.options.showLegend=!1);var a=new google.visualization.DataTable;if(a.addColumn("string","Date"),_.each(s,function(e){a.addColumn("number",e)}),_.each(this.data,function(e){var t=[],n=r(e.timeframe.start),o=i(n,this.query.attributes.interval);t.push(o),_.each(e.value,function(e){null==e.result&&(e.result=0),t.push(e.result)},this),1==t.length&&t.push(null),a.addRow(t)},this),google){var l=new google.visualization.LineChart(e),h=o(this.options);clearInterval(n),l.draw(a,h)}else console.log("Charting is not yet ready.  Are you waiting for onChartsReady?")},this);_.isUndefined(t)?this.query.getResponse(s):s(t)},Keen.PieChart=Keen.BaseVisualization.extend({constructor:function(e,t){this.query=e,this.options={height:300,width:600,chartAreaHeight:null,chartAreaWidth:null,chartAreaLeft:null,chartAreaTop:null,minimumSlicePercentage:"1",title:null,showLegend:!0,colors:null,backgroundColor:"white",fontColor:"black"},this.options=_.extend(this.options,t),this.client=_.isUndefined(this.options.client)?Keen.client:this.options.client}}),Keen.PieChart.prototype.draw=function(e,t){e.innerHTML="",e.style.width=this.options.width+"px",e.style.height=this.options.height+"px",e.style.display="block";var n=Keen.showLoading(e),i=function(e){var t={};return t.legend={},t.height=e.height,t.width=e.width,t.title=e.title,t.sliceVisibilityThreshold=.01*e.minimumSlicePercentage,t.colors=e.colors,t.backgroundColor=e.backgroundColor,e.showLegend||(t.legend.position="none"),t.titleTextStyle={color:e.fontColor},t.legend.textStyle={color:e.fontColor},t.chartArea={left:e.chartAreaLeft,top:e.chartAreaTop,height:e.chartAreaHeight,width:e.chartAreaWidth},t},r=_.bind(function(t){this.data=t.result;var r=new google.visualization.DataTable;if(r.addColumn("string","Group By"),r.addColumn("number",this.getLabel()),_.each(this.data,function(e){var t=e[this.query.attributes.groupBy]+"",n=e.result;r.addRow([t,n])},this),google){var o=new google.visualization.PieChart(e);clearInterval(n),o.draw(r,i(this.options))}else console.log("Charting is not yet ready.  Are you waiting for onChartsReady?")},this);_.isUndefined(t)?this.query.getResponse(r):r(t)},Keen.FunnelChart=Keen.BaseVisualization.extend({constructor:function(e,t){this.query=e,this.options={height:300,width:600,chartAreaHeight:null,chartAreaWidth:null,chartAreaLeft:null,chartAreaTop:null,title:null,showLegend:!1,color:"#f35757",backgroundColor:"white",fontColor:"black"},this.options=_.extend(this.options,t),this.client=_.isUndefined(this.options.client)?Keen.client:this.options.client}}),Keen.FunnelChart.prototype.draw=function(e,t){e.innerHTML="",e.style.width=this.options.width+"px",e.style.height=this.options.height+"px",e.style.display="block";var n=Keen.showLoading(e),i=function(e){var t={};return t.legend={},t.height=e.height,t.width=e.width,t.title=e.title,t.colors=[e.color],t.backgroundColor=e.backgroundColor,e.showLegend||(t.legend.position="none"),t.titleTextStyle={color:e.fontColor},t.legend.textStyle={color:e.fontColor},t.chartArea={left:e.chartAreaLeft,top:e.chartAreaTop,height:e.chartAreaHeight,width:e.chartAreaWidth},t.vAxis={minValue:0,format:"#"},t.bar={groupWidth:"90%"},t},r=_.bind(function(t){this.numbers=t.result,this.steps=t.steps;var r=new google.visualization.DataTable;r.addColumn("string","Action"),r.addColumn("number","Count");for(var o=null,s=0;this.numbers.length>s;s++){null==o&&(o=this.numbers[s]);var a=Math.round(100*(this.numbers[s]/o)),l=this.steps[s].event_collection;_.isUndefined(this.query.steps[s].name)||(l=this.query.steps[s].name),r.addRow([l+" ("+a+"%)",this.numbers[s]])}if(google){var h=new google.visualization.ColumnChart(e);clearInterval(n),h.draw(r,i(this.options))}else console.log("Charting is not yet ready.  Are you waiting for onChartsReady?")},this);_.isUndefined(t)?this.query.getResponse(r):r(t)},Keen.BaseQuery=l.extend({getResponse:function(e){function t(t){return e(t)}function n(e,t){console.log("got an error:"),console.log(e),console.log(t)}if(_.isUndefined(this.client.apiKey))console.log("Error: Please add an apiKey to Keen.configure() to perform analysis.");else{var i=this.getPath(),r=this.buildParams();i+="?",i+=s(r);var o=this.client.getKeenUrl(i);this.client.getJSON(o,t,n)}},getPath:function(){console.log("getPath() must be overridden")},buildParams:function(){console.log("buildParams() must be overridden")}}),Keen.SavedQuery=Keen.BaseQuery.extend({constructor:function(e,t){this.queryName=e,this.client=t?t:Keen.client},getPath:function(){return"/saved_queries/"+encodeURIComponent(this.queryName)+"/result"},buildParams:function(){return{api_key:this.client.apiKey}}}),Keen.AdHocQuery=Keen.BaseQuery.extend({constructor:function(e,t,n){_.isUndefined(t)&&(t={}),this.attributes=_.defaults(t,{filters:[]}),this.attributes.eventCollection=e,_.isUndefined(this.attributes.timezone)&&(this.attributes.timezone=o()),this.client=n?n:Keen.client},getPath:function(){return"/queries/"+this.attributes.analysisType},buildParams:function(){return{api_key:this.client.apiKey,event_collection:this.attributes.eventCollection,filters:this.attributes.filters,timeframe:this.attributes.timeframe,timezone:this.attributes.timezone,target_property:this.attributes.targetProperty,group_by:this.attributes.groupBy}}}),Keen.AdHocQuery.prototype.addFilter=function(e,t,n){return this.attributes.filters.push({property_name:e,operator:t,property_value:n}),this},Keen.AdHocQuery.prototype.timeframe=function(e){return this.attributes.timeframe=e,this},Keen.AdHocQuery.prototype.timezone=function(e){return this.attributes.timezone=e,this},Keen.AdHocQuery.prototype.analysisType=function(e){return this.attributes.analysisType=e,this},Keen.AdHocQuery.prototype.targetProperty=function(e){return this.attributes.targetProperty=e,this},Keen.AdHocQuery.prototype.groupBy=function(e){return this.attributes.groupBy=e,this},Keen.Funnel=Keen.BaseQuery.extend({constructor:function(e,t,n){_.isUndefined(t)&&(t={}),this.attributes=t,_.isUndefined(e)&&(e=[]),this.steps=e;for(var i=0;this.steps.length>i;i++)this.steps[i]=this.steps[i].buildParams();_.isUndefined(this.attributes.timezone)&&(this.attributes.timezone=o()),this.client=n?n:Keen.client},getPath:function(){return"/queries/funnel"},buildParams:function(){if(!_.isUndefined(this.attributes.actorProperty))for(var e=0;this.steps.length>e;e++)_.isUndefined(this.steps[e].actor_property)&&(this.steps[e].actor_property=this.attributes.actorProperty);return{api_key:this.client.apiKey,steps:this.steps,timeframe:this.attributes.timeframe,timezone:this.attributes.timezone,actor_property:this.attributes.actorProperty}},draw:function(e,t){var n=new Keen.FunnelChart(this,t);n.draw(e)}}),Keen.Funnel.prototype.timeframe=function(e){return this.attributes.timeframe=e,this},Keen.Funnel.prototype.actorProperty=function(e){return this.attributes.actorProperty=e,this},Keen.Funnel.prototype.timezone=function(e){return this.attributes.timezone=e,this},Keen.Funnel.prototype.addStep=function(e){return this.steps.push(e.buildParams()),this},Keen.Step=Keen.AdHocQuery.extend({constructor:function(e,t){_.isUndefined(t)&&(t={}),this.attributes=_.defaults(t,{filters:[]}),this.attributes.eventCollection=e,_.isUndefined(this.attributes.timezone)&&(this.attributes.timezone=o())},buildParams:function(){return{event_collection:this.attributes.eventCollection,actor_property:this.attributes.actorProperty,filters:this.attributes.filters,timeframe:this.attributes.timeframe,timezone:this.attributes.timezone,name:this.attributes.name}}}),Keen.Step.prototype.name=function(e){return this.attributes.name=e,this},Keen.Step.prototype.actorProperty=function(e){return this.attributes.actorProperty=e,this},Keen.Metric=Keen.AdHocQuery.extend({}),Keen.Metric.prototype.draw=function(e,t){if(_.isUndefined(this.attributes.groupBy)){var n=new Keen.Number(this,t);n.draw(e)}else{var i=new Keen.PieChart(this,t);i.draw(e)}},Keen.Series=Keen.AdHocQuery.extend({buildParams:function(){var e=this.base();return e.interval=this.attributes.interval,e},draw:function(e,t){if(_.isUndefined(this.attributes.groupBy)){var n=new Keen.LineChart(this,t);n.draw(e)}else{var i=new Keen.MultiLineChart(this,t);i.draw(e)}}}),Keen.Series.prototype.interval=function(e){return this.attributes.interval=e,this},Keen.showLoading=function(e){var t=function(e){return+e.replace(/[^\d.-]+/gi,"")},n=t(e.style.height);n=(n-96)/2;var i=document.createElement("div");i.style.cssText="margin: 0px auto;width: 96px;height: 96px;background: #f0f;position: relative;overflow: hidden;background: url(https://keen_web_static.s3.amazonaws.com/img/spinners/logo_spinner_sprite.png);background-position: 0px 0px;",i.style.top=n+"px",e.appendChild(i);var r=window.setInterval(function(){var e=i.style.backgroundPosition;e=e.split(" "),e=t(e[0]),e-=96,i.style.backgroundPosition=e+"px 0px"},64);return r},Keen.prettyNumber=function(e){function t(e,n){var e=e+"",i=e.split(".");if(i.length>1){e=i[0];var o=i[1];2==e.length&&o.length>0?o.length>0?e=e+"."+o.charAt(0):e+="0":1==e.length&&o.length>0&&(e=e+"."+o.charAt(0),e+=o.length>1?o.charAt(0):"0")}var s=e.length;return e.split(".").length>1&&s--,3>=s?e+""+r[n]:t(Number(e)/1e3,n+1)}var n=e.toPrecision(3);if(Number(n)==e&&4>=(e+"").length)return e+"";if(e>=1||-1>=e){var i="";0>e&&(e=-e,i="-");var r=["","k","M","B","T"];return i+t(e,0)}return e.toPrecision(3)},Keen.loadedCallback&&"function"==typeof Keen.loadedCallback&&Keen.loadedCallback()})();