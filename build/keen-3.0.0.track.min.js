!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("Keen",this,function(){"use strict";function Keen(){return init.apply(this,arguments)}function init(a){return void 0===a?Keen.log("Check out our JavaScript SDK Usage Guide: https://keen.io/docs/clients/javascript/usage-guide/"):void 0===a.projectId?Keen.log("Please provide a projectId"):void this.configure(a)}function _setRequestType(a){var b=a,c="string"==typeof(new XMLHttpRequest).responseType;return null==b||"xhr"==b?c?"xhr":"jsonp":b}function _buildURL(a){return this.client.keenUrl+"/projects/"+this.client.projectId+a}function _uploadEvent(a,b,c,d){var e=_buildURL.apply(this,["/events/"+a]),f={};this.client.globalProperties&&(f=this.client.globalProperties(a));for(var g in b)b.hasOwnProperty(g)&&(f[g]=b[g]);switch(this.client.requestType){case"xhr":_sendXHR.apply(this,["POST",e,null,f,this.client.writeKey,c,d]);break;case"jsonp":var h=JSON.stringify(f),i=Keen.Base64.encode(h);e=e+"?api_key="+this.client.writeKey,e=e+"&data="+i,e=e+"&modified="+(new Date).getTime(),_sendJSONP.apply(this,[e,this.client.writeKey,c,d]);break;case"beacon":var h=JSON.stringify(f),i=Keen.Base64.encode(h);e=e+"?api_key="+encodeURIComponent(this.client.writeKey),e=e+"&data="+encodeURIComponent(i),e=e+"&modified="+encodeURIComponent((new Date).getTime()),e+="&c=clv1",_sendBeacon(e,null,c,d)}}function _sendXHR(a,b,c,d,e,f,g){if(!e)return Keen.log("Please provide a writeKey for https://keen.io/project/"+this.client.projectId);console.log(arguments);var h=new XMLHttpRequest;if(h.onreadystatechange=function(){if(4==h.readyState)if(h.status>=200&&h.status<300){var a;try{a=JSON.parse(h.responseText)}catch(b){Keen.log("Could not JSON parse HTTP response: "+h.responseText),g&&g(h,b)}a&&f&&f(a)}else Keen.log("HTTP request failed."),g&&g(h,null)},h.open(a,b,!0),e&&h.setRequestHeader("Authorization",e),d&&h.setRequestHeader("Content-Type","application/json"),c)for(var i in c)c.hasOwnProperty(i)&&h.setRequestHeader(i,c[i]);var j=d?JSON.stringify(d):null;h.send(j)}function _sendJSONP(a,b,c,d){if(!b)return Keen.log("Please provide a writeKey for https://keen.io/project/"+this.client.projectId);if(console.log(arguments),b&&a.indexOf("api_key")<0){var e=a.indexOf("?")>0?"&":"?";a=a+e+"api_key="+b}for(var f="keenJSONPCallback"+(new Date).getTime();f in window;)f+="a";var g=!1;window[f]=function(a){g=!0,c&&a&&c(a),window[f]=void 0},a=a+"&jsonp="+f;var h=document.createElement("script");h.id="keen-jsonp",h.src=a,document.getElementsByTagName("head")[0].appendChild(h),h.onreadystatechange=function(){g===!1&&"loaded"===this.readyState&&(g=!0,d&&d())},h.onerror=function(){g===!1&&(g=!0,d&&d())}}function _sendBeacon(a,b,c,d){if(b&&a.indexOf("api_key")<0){var e=a.indexOf("?")>0?"&":"?";a=a+e+"api_key="+b}var f=!1,g=document.createElement("img");g.onload=function(){if(f=!0,"naturalHeight"in this){if(this.naturalHeight+this.naturalWidth===0)return void this.onerror()}else if(this.width+this.height===0)return void this.onerror();c&&c({created:!0})},g.onerror=function(){f=!0,d&&d()},g.src=a}function _utf8_encode(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}function _utf8_decode(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}Keen.prototype={configure:function(a){return this.client={projectId:a.projectId,writeKey:a.writeKey,readKey:a.readKey,globalProperties:null,keenUrl:a.keenUrl?a.keenUrl:"https://api.keen.io/3.0",requestType:_setRequestType(a.requestType||"xhr")},this},addEvent:function(){_uploadEvent.apply(this,arguments)},trackExternalLink:function(a,b,c,d,e){void 0===d&&(d=500);var f=!1,g=function(){};return"A"===a.nodeName?g=function(){f||(f=!0,window.location=a.href)}:"FORM"===a.nodeName&&(g=function(){f||(f=!0,a.submit())}),e&&(g=function(){f||(f=!0,e())}),_uploadEvent.apply(this,arguments),setTimeout(function(){g()},d),!1},setGlobalProperties:function(a){if(!this.client)return Keen.log("Check out our JavaScript SDK Usage Guide: https://keen.io/docs/clients/javascript/usage-guide/");if(!a||"function"!=typeof a)throw new Error("Invalid value for global properties: "+a);this.client.globalProperties=a}},Keen.Base64={encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=_utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+_keyStr.charAt(e)+_keyStr.charAt(f)+_keyStr.charAt(g)+_keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=_keyStr.indexOf(a.charAt(j++)),f=_keyStr.indexOf(a.charAt(j++)),g=_keyStr.indexOf(a.charAt(j++)),h=_keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=_utf8_decode(i)}};var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(var instance in window._KeenCache)if(window._KeenCache.hasOwnProperty(instance)){var client=window._KeenCache[instance];for(var method in Keen.prototype)Keen.prototype.hasOwnProperty(method)&&(window.Keen.prototype[method]=Keen.prototype[method]);client._cf&&client.configure(client._cf),client._gp&&client.setGlobalProperties(client._gp);var queue=client._eq;if(queue&&queue.length>0)for(var i=0;i<queue.length;i++){var eventCollection=queue[i].shift(),payload=queue[i].shift(),success=queue[i].shift(),error=queue[i].shift();client.addEvent(eventCollection,payload,success,error)}var callback=client._ocrq;if(callback&&callback.length>0)for(var i=0;i<callack.length;i++){var handler=callback[i];Keen.onChartsReady(handler)}}return Keen.log=function(a){console.log("[Keen IO]",a)},"object"!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Keen});