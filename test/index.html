<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Keen IO JS SDK Test</title>

	<!-- Test Framework Assets -->
	<link rel="stylesheet" href="./lib/mocha/mocha.css" />
	<script src="./lib/mocha/mocha.js"></script>
	<script src="./lib/chai/chai.js"></script>
	<script src="./lib/sinon/index.js"></script>
	
	<!-- File(s) to be tested -->
	<script src="./dist/keen-3.0.0.js" type="text/javascript"></script>
	
	<!-- Setup -->
	<script>mocha.setup('bdd')</script>
	
	<script src="./test.keen.js" type="text/javascript"></script>

	<script>
		onload = function(){
			//mocha.checkLeaks();
			//mocha.globals(['foo']);
			var runner = mocha.run();

			var failedTests = [];
			runner.on('end', function(){
				window.mochaResults = runner.stats;
				window.mochaResults.reports = failedTests;
			});

			runner.on('fail', logFailure);

			function logFailure(test, err){

				var flattenTitles = function(test){
					var titles = [];
					while (test.parent.title){
						titles.push(test.parent.title);
						test = test.parent;
					}
					return titles.reverse();
				};

				failedTests.push({name: test.title, result: false, message: err.message, stack: err.stack, titles: flattenTitles(test) });
			};
		};
	</script>
	
	
	<!--
  <script src="specHelper.js" type="text/javascript"></script>
	<script src="keenSpec.js" type="text/javascript"></script>
	<script type="text/javascript" src="keenIntegrationSpec.js"></script>
  <script type="text/javascript">
    (function() {
      var jasmineEnv = jasmine.getEnv();
      jasmineEnv.updateInterval = 1000;

      var htmlReporter = new jasmine.HtmlReporter();

      jasmineEnv.addReporter(new jasmine.HtmlReporter());
			jasmineEnv.addReporter(new jasmine.JSReporter());

      jasmineEnv.specFilter = function(spec) {
        return htmlReporter.specFilter(spec);
      };

      var currentWindowOnload = window.onload;

      window.onload = function() {
        if (currentWindowOnload) {
          currentWindowOnload();
        }
        execJasmine();
      };

      function execJasmine() {
        jasmineEnv.execute();
      }

    })();
	</script>
	-->
</head>
<body>
	<div id="mocha"></div>
</body>
</html>

